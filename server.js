const express=require("express"),cors=require("cors"),bodyParser=require("body-parser"),mysql=require("mysql2"),bcrypt=require("bcrypt"),path=require("path"),app=express(),PORT=process.env.PORT||3e3,saltRounds=10;app.use(cors()),app.use(bodyParser.json()),app.use(express.static(path.join(__dirname,"public")));const db=mysql.createConnection({host:"sql10.freesqldatabase.com",user:"sql10799195",password:"rT9BIiqNUY",database:"sql10799195"});db.connect((s=>{s?console.error("❌ Erro ao conectar ao MySQL:",s):console.log("✅ Conectado ao MySQL!")})),app.post("/api/cadastro",(async(s,e)=>{const{user:o,password:r}=s.body;if(!o||!r)return e.status(400).json({mensagem:"Campos obrigatórios."});try{const s=await bcrypt.hash(r,10),a="INSERT INTO usuarios (email, senha) VALUES (?, ?)";db.query(a,[o,s],((s,o)=>s?(console.error("❌ Erro ao cadastrar:",s.code,s.sqlMessage),e.status(500).json({mensagem:"Erro ao salvar no banco."})):e.status(201).json({mensagem:"Cadastro feito com sucesso!"})))}catch(s){return console.error("❌ Erro ao criptografar senha:",s),e.status(500).json({mensagem:"Erro interno."})}})),app.post("/api/login",((s,e)=>{const{user:o,password:r}=s.body;db.query("SELECT * FROM usuarios WHERE email = ?",[o],(async(s,o)=>{if(s)return console.error("❌ Erro na consulta:",s),e.status(500).json({mensagem:"Erro interno no servidor."});if(0===o.length)return e.status(401).json({sucesso:!1,mensagem:"Usuário não encontrado."});return await bcrypt.compare(r,o[0].senha)?e.status(200).json({sucesso:!0,mensagem:"Login autorizado."}):e.status(401).json({sucesso:!1,mensagem:"Senha incorreta."})}))})),app.get("/privacidade",((s,e)=>{e.send("\n    <h1>Política de Privacidade</h1>\n    <p>Este site é um projeto pessoal de demonstração. Os dados inseridos (e-mail e senha) são armazenados apenas para fins de teste e não são compartilhados com terceiros.</p>\n  ")})),app.listen(PORT,(()=>{console.log(`🚀 Servidor rodando na porta ${PORT}`)}));